{"version":3,"sources":["../../src/utils/stack-trace-utils.js"],"names":["stackTrace","require","codeFrameColumns","fs","path","chalk","gatsbyLocation","dirname","resolve","getNonGatsbyCallSite","get","find","callSite","getFileName","includes","getNonGatsbyCodeFrame","highlightCode","fileName","line","getLineNumber","column","getColumnNumber","code","readFileSync","encoding","bold","start","join","module","exports"],"mappings":";;AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAE,aAAF,CAA1B;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAuBD,OAAO,CAAE,mBAAF,CAApC;;AACA,MAAME,EAAE,GAAGF,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAMG,IAAI,GAAGH,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMI,KAAK,GAAGJ,OAAO,CAAE,OAAF,CAArB;;AAEA,MAAMK,cAAc,GAAGF,IAAI,CAACG,OAAL,CAAaN,OAAO,CAACO,OAAR,CAAiB,qBAAjB,CAAb,CAAvB;;AAEA,MAAMC,oBAAoB,GAAG,MAC3BT,UAAU,CACPU,GADH,GAEGC,IAFH,CAGIC,QAAQ,IACNA,QAAQ,IACRA,QAAQ,CAACC,WAAT,EADA,IAEA,CAACD,QAAQ,CAACC,WAAT,GAAuBC,QAAvB,CAAgCR,cAAhC,CANP,CADF;;AAUA,MAAMS,qBAAqB,GAAG,CAAC;AAAEC,EAAAA,aAAa,GAAG;AAAlB,IAA2B,EAA5B,KAAmC;AAC/D,QAAMJ,QAAQ,GAAGH,oBAAoB,EAArC;;AACA,MAAI,CAACG,QAAL,EAAe;AACb,WAAO,IAAP;AACD;;AAED,QAAMK,QAAQ,GAAGL,QAAQ,CAACC,WAAT,EAAjB;AACA,QAAMK,IAAI,GAAGN,QAAQ,CAACO,aAAT,EAAb;AACA,QAAMC,MAAM,GAAGR,QAAQ,CAACS,eAAT,EAAf;AAEA,QAAMC,IAAI,GAAGnB,EAAE,CAACoB,YAAH,CAAgBN,QAAhB,EAA0B;AAAEO,IAAAA,QAAQ,EAAG;AAAb,GAA1B,CAAb;AACA,SAAO,CACJ,QAAOnB,KAAK,CAACoB,IAAN,CAAY,GAAER,QAAS,IAAGC,IAAK,IAAGE,MAAO,EAAzC,CAA4C,EAD/C,EAELlB,gBAAgB,CACdoB,IADc,EAEd;AACEI,IAAAA,KAAK,EAAE;AACLR,MAAAA,IADK;AAELE,MAAAA;AAFK;AADT,GAFc,EAQd;AACEJ,IAAAA;AADF,GARc,CAFX,EAcLW,IAdK,CAcC,IAdD,CAAP;AAeD,CA1BD;;AA4BAC,MAAM,CAACC,OAAP,GAAiB;AACfd,EAAAA;AADe,CAAjB","sourcesContent":["const stackTrace = require(`stack-trace`)\nconst { codeFrameColumns } = require(`@babel/code-frame`)\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst chalk = require(`chalk`)\n\nconst gatsbyLocation = path.dirname(require.resolve(`gatsby/package.json`))\n\nconst getNonGatsbyCallSite = () =>\n  stackTrace\n    .get()\n    .find(\n      callSite =>\n        callSite &&\n        callSite.getFileName() &&\n        !callSite.getFileName().includes(gatsbyLocation)\n    )\n\nconst getNonGatsbyCodeFrame = ({ highlightCode = true } = {}) => {\n  const callSite = getNonGatsbyCallSite()\n  if (!callSite) {\n    return null\n  }\n\n  const fileName = callSite.getFileName()\n  const line = callSite.getLineNumber()\n  const column = callSite.getColumnNumber()\n\n  const code = fs.readFileSync(fileName, { encoding: `utf-8` })\n  return [\n    `File ${chalk.bold(`${fileName}:${line}:${column}`)}`,\n    codeFrameColumns(\n      code,\n      {\n        start: {\n          line,\n          column,\n        },\n      },\n      {\n        highlightCode,\n      }\n    ),\n  ].join(`\\n`)\n}\n\nmodule.exports = {\n  getNonGatsbyCodeFrame,\n}\n"],"file":"stack-trace-utils.js"}